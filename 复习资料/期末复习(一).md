# 操作系统期末复习

## 第一章 操作系统引论

### 1. 什么是操作系统

&emsp;操作系统为用户完成所有"硬件相关、应用无关"的工作，以给用户方便、高效、安全的使用环境。

#### 1.1 定义

&emsp;操作系统是一个大型的程序系统，它负责计算机的全部软、硬件资源的分配、调度工作，控制并协调多个任务的活动，实现信息的存取和保护。它提供用户接口，使用户获得良好的工作环境。

#### 1.2 目标

- 方便性：配置 OS 后计算机系统更容易使用；
- 有效性：改善资源利用率；提高系统吞吐量；
- 可扩充性：OS 的结构（无结构发展 -> 模块化结构 -> 层次化结构 -> 微内核结构）
- 开放性：OS 遵循世界标准范围。

#### 1.3 作用

- OS 作为用户与计算机硬件系统之间的接口。**OS 处于用户与计算机硬件系统之间，用户通过 OS 来使用计算机系统**。
- OS 是计算机系统资源的管理者。
  - 处理机管理是用于分配和控制处理机；
  - 存储器管理是负责内存的分配与回收；
  - IO 设备管理是负责 IO 设备的分配与操作；
  - 文件管理是用于实现文件的存取、共享和保护；
- OS 实现了对计算机资源的抽象

### 2. 操作系统的发展过程

#### 2.1 手工操作阶段

&emsp;人工操作方式：用户独占全机，资源空闲浪费。

- 手工装卸、人工判断、手工修改与调试内存指令等造成 CPU 空闲；
- 提前完成造成剩余预约时间内的 CPU 完全空闲；
- IO 设备的慢速与 CPU 的速度不匹配造成的 CPU 空闲等待时机；

#### 2.2 单道批处理系统

&emsp;单道批处理系统是在解决人机矛盾和 CPU 与 IO 设备速度不匹配矛盾的过程中形成的。批处理系统旨在提高系统资源的利用率和系统的吞吐量。

&emsp;缺点：**系统资源利用率低**

&emsp;特征：

- 自动性：一批作业自动依次运行，无需人工干预；
- 顺序性：各道作业是顺序进入内存；
- 单道性：内存中任意时刻只有一道作业；

#### 2.3 多道批处理系统

&emsp;为了进一步提高资源利用率和系统吞吐量。在该系统中，用户提交的作业都先存在外存中，在作业 A 在执行 IO 请求时，CPU 空闲，此时调度作业 B，防止 CPU 空闲。同理按一定的算法调用作业，防止 CPU 空闲。

> 推动多道批处理系统形成和发展的动力是提高资源利用率和系统吞吐量。

&emsp;优点：

- 资源利用率高；
- 系统吞吐量大；

&emsp;缺点：

- 平均周转时间长；
- 无交互能力；

&emsp;特点：

- 多道：内存同时存在多个作业；
- 宏观上并行：同时有多道程序在内存中运行；
- 微观上串行：任意时刻最多只有一道作业占用 CPU，多道程序交替使用 CPU

#### 2.4 分时系统

&emsp;分时系统是指在一台主机上连接多个带有显示器和键盘的终端，同时允许多个用户通过自己的键盘，以交互的方式使用计算机，共享主机中的资源。

&emsp;特征：

- 多路性：允许同一主机联接多台终端；
- 独立性：每一用户独占一个终端；每个用户感觉不到其它用户的存在；
- 及时性：用户请求能及时响应；
- 交互性：可进行广泛的人机对话

#### 2.5 实时操作系统

&emsp;实时操作系统是指系统能及时响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。

&emsp;特征：

- 多路性：对实时处理系统，系统按分时原则为多个终端服务；对实时控制系统，系统经常对多路现场信息进行采集；以及对多个对象或多个执行机构进行控制；
- 独立性：实时处理下系统，每个终端用户向实时系统提出服务请求时，彼此独立；实时控制系统对信息的采集和对对象的控制彼此不干扰；
- 及时性：开始截止时间/完成截止时间；
- 交互性：仅限于访问专用服务程序；
- 可靠性：多级容错措施保障系统和数据安全；

#### 2.6 微机操作系统

#### 2.7 多处理机操作系统

#### 2.8 网络操作系统

#### 2.9 分布式操作系统

#### 2.10 嵌入式操作系统

### 3. 操作系统的基本特征

#### 3.1 并发

&emsp;并发是指在内存中放多道作业，在一个时间段上看，每一道作业能不同程度地向前推进。但在任何一个时间点上只能有一道占用 CPU。

- 串行：在内存中每次只能放一道作业，只有它完全执行完后别的作业才能进入内存执行；
- 并行：存在于有多个 CPU 的环境中，在内存中放多道作业，在任意时间点上都可能有多道作业在不同的 CPU 上同时执行；

#### 3.2 共享

&emsp;系统中的资源可供多个并发的进程共同使用。根据资源属性的不同，有两种资源共享方式：**互斥共享方式**和**同时访问方式**。

#### 3.3 虚拟

&emsp;通过某种技术将一个物理实体映射为若干个逻辑上对应物，或将多个物理实体映射为一个逻辑实体。

&emsp;虚拟是操作系统管理系统资源的重要手段，可提高资源利用率。

#### 3.4 异步

&emsp;不确定性：什么时候开始，执行多久时间，终止时间。

### 4.操作系统的主要功能

- **处理机管理功能**：进程控制、进程同步、进程通信、调度；
- **存储器管理功能**：内存分配、内存保护、存储扩充、地址映射；
- **设备管理功能**：缓冲管理、设备分配、设备处理；
- **文件管理功能**：文件存储空间的管理、目录管理、文件的读/写管理和保护；
- 操作系统与用户之间的接口：命令接口、程序接口、图形接口；
- 现代 OS 的新功能：系统安全、支持多媒体、网络通信等。

### 5. 操作系统的结构设计

&emsp;传统 OS 结构:无结构 OS、模块化 OS、分层式 OS；
&emsp;现代 OS 结构：微内核结构；

## 第二章 进程的描述与控制

### 1. 进程的定义和特征

&emsp;进程有各式各样的定义：

- 行为的一个规则叫做程序，程序在处理机上执行时所发生的活动称为进程。
- 具有一定功能的程序在某个数据集合上的一次活动。
- 进程是一个程序与其数据一道通过处理机的执行所发生的活动。
- 进程是指进程实体的运行过程，是系统进行资源分配和调度的独立单位。
- 程序的执行过程，从开始到 结束

&emsp;进程的特征：

- 结构性：由程序、数据、控制块三部分组成；
- 动态性：进程是程序的执行过程；
- 并发性：多个进程可同存于内存中，能在一段时间内同时运行；
- 独立性：独立运行的基本单位，独立获得资源和调度的基本单位；
- 异步性：各进程按各自独立的不可预知的速度向前推进；

### 2. 进程与程序的区别：

- 程序是指令的有序集合，与其本身没有任何运行含义，是一个静态概念。
- 进程是程序在处理机上的一次执行过程，它是一个动态的概念。
- 进程更能真实地描述并发，而程序不能；
- 进程是由程序、数据和进程控制块三部分组成的；
- 同一程序同时运行于若干数据集合上，它将属于若干个不同的进程。也就是说，一个程序可以对应多个进程。

### 3. 进程的 3 种状态及转换

- 就绪状态（R 态）：**存在于处理机调度队列中的所有进程，它们已经准备就绪，一旦得到 CPU，就立即可以运行**。
- 运行状态（E 态）：正在运行的进程所处的状态为运行状态。
- 等待/阻塞/睡眠状态（B 态）：若一个进程正在等待某一事件发生，这时即使给它 CPU，它也无法运行，该进程状态就处于等待状态。

![alt text](images/2.1.png)

&emsp;状态进程模型：

![alt text](images/2.2.png)

### 4. 进程控制块 PCB

&emsp;PCB 是 OS 中最重要的记录型数据结构：

- PCB 是 OS 感知进程存在的唯一标志；
- 进程与 PCB 是一一对应的；
- PCB 随进程创建而建立，随进程结束而回收；
- PCB 应常驻内存；

> PCB 的作用是：**将一个不能独立运行的程序变成一个可以独立运行的基本单位，一个能与其它进程并发执行的进程**。

&emsp;进程描述信息：

- 进程标识符：唯一，通常是一个整数；
- 进程名：基于可执行文件名；
- 用户标识符：进程组关系；

### 5. 进程同步

#### 5.1 制约关系

- 间接相互制约关系：系统资源竞争，进程间彼此无关；
- 直接相互制约关系：进程间合作，彼此相关；

#### 5.2 临界资源

&emsp;一次仅允许一个进程访问的资源。

#### 5.3 临界区

&emsp;临界段，在每个程序中，访问临界资源的那段程序。

> &emsp;程序段 A、B 有关于变量 X 的临界区，而 C、D 有关于变量 Y 的临界区，那么 A、B 之间需要互斥执行，C、D 之间也需要互斥执行，但 A 与 C、B 与 D 之间不需要互斥执行。
> **&emsp;临界区是对某一临界资源而言的，对于不同临界资源的临界区，它们之间不存在互斥。**

#### 5.4 同步机制应遵循的规则

- 空闲让进；
- 忙则等待；
- 有限等待；
- 让权等待；

#### 5.5 信号量机制

- 整型信号量：定义一个整型量，由两个标准原子操作 wait(S)(即：P 操作)和 signal(S)(即：V 操作)来访问。两个操作均为原语操作。

##### 例题

---

&emsp;**1、桌上有一空盘，最多允许存放一只水果。爸爸可向盘中放一个苹果或放一个桔子，儿子专等吃盘中的桔子，女儿专等吃苹果。试用 P、V 操作实现爸爸、儿子、女儿三个并发进程的同步。**

> 设置三个信号量：S,So,Sa。
>
> - S: 表示可否向盘中放水果，初始值为 1，表示能放水果；
> - So:表示可否取橘子，初始值为 0；
> - Sa: 表示可否取苹果，初始值为 0;

```
Father(){
  while(1){
    P(S);
    // 将水果放入盘中
    if(是橘子){
      V(So);
    }else{
      V(Sa);
    }
  }
}

Son(){
  while(1){
    P(So);
    // 取橘子
    V(S);
    // 吃橘子
  }
}

Daughter() {
  while(1){
    P(Sa);
    // 取苹果
    V(S);
    // 吃苹果
  }
}
```

---

&emsp;**2.有一个仓库，可以存放 A 和 B 两种产品。存储空间充分大，但要求：（1） 每次只能存入一种产品（A 或 B）（2） －N ＜ A 产品数量－B 产品数量＜ M。其中，N 和 M 是正整数。试用 P、V 操作描述产品 A 与 B 的入库过程。**

> 设置互斥信号量：mutex，初始值为 1
> Sa: 表示允许 A 产品比 B 产品多入库的数量，初值为 M-1;即 B 的数量为 0，A 最多为 M-1；
> Sb: 表示允许 B 产品比 A 产品多入库的数量，初始值为 N-1;即 A 的数量为 0,B 最多为 N-1

```
// A产品入库进程
while(1){
  // 生产A产品
  P(Sa);
  P(mutex);
  // A入库
  V(mutex);
  V(sb);
}

// B产品入库进程
while(1){
  // 生产B产品
  P(Sb);
  p(mutex);
  // B入库
  V(mutex);
  V(Sa);
}
```

&emsp;**3、问题描述：假定阅览室最多容纳 100 人阅读，读者进入时，必须在门口的登记表上登记，内容包括：姓名、座号等；离开时要撤销登记内容。用 P、V 操作描述读者进程的同步算法。**

```
define CHAIR 100 // 定义椅子数量
define mutex=1 // 互斥量 可视为锁
define readers=0 // 当前阅览室读者数量

// 读者进程
void readeri(i=1,2,3,...){
  P(mutex); // 获取锁
  if(readers < CHAIR){

    // 读者登记操作
    readers++; // 读者数量+1
    V(mutex); // 释放锁
    // 阅读

    P(mutex); //获取锁，准备离开了
    // 撤销登记
    readers--;
    V(mutex); // 释放锁

  }else{
    V(mutex); // 没椅子就直接释放锁
  }
}

```

&emsp;**4、问题描述：理发店由一个有几张凳子的等待室和一个放有一张理发椅的理发室组成。若没有理发的人员，理发师睡觉；若顾客到来，且所有的椅子占满，则该顾客离开理发店；若理发师正在理发，则该顾客就找一张椅子坐下等待；若理发师在睡觉，则该顾客唤醒理发师。设计一个理发师和顾客的协调程序。**

```
define CHAIR N // 理发店有N把椅子
define mutex=1 // 互斥锁，用于保护对临界资源的访问
define barber_ready=0 // 用于表示理发师是否准备好理发，因为刚开始理发师在睡觉
define customer_ready=0 // 用于表示顾客是否准备好理发
define waiting=0 // 等待的顾客数量

// 理发师进程
void barber(){
  while(1){
    P(customer_ready); // 等待顾客前来理发
    P(mutex); // 获取锁
    waiting--;
    V(barber_ready); // 通知理发师进行理发
    V(mutex);  // 释放锁
    // 理发
  }
}

// 顾客进程
void customer(){
  P(mutex);// 获取锁
  if(waiting < N){
    waiting++; // 等待顾客+1
    V(customer_reader); // 通知有顾客前来理发
    V(mutex); // 释放锁
    P(barber_ready); // 等待理发师
    // 理发

  }else{
    V(mutex);//释放锁
    // 离开
  }
}

```

### 6. 进程通信

| 方式     | 传输的信息量       | 使用场景       | 关键词                                                                 |
| -------- | ------------------ | -------------- | ---------------------------------------------------------------------- |
| 信号     | 少量               | 任何           | 硬件来源、软件来源 / 信号队列                                          |
| 管道     | 大量               | 亲缘进程间     | 单向流动 / 内核缓冲区 / 循环队列 / 没有格式的字节流 / 操作系统负责同步 |
| 命名管道 | 大量               | 任何           | 磁盘文件 / 访问权限 / 无数据块 / 内核缓冲区 / 操作系统负责同步         |
| 信号量   | N                  | 任何           | 互斥同步 / 原子性 / P 减 V 增                                          |
| 共享内存 | 大量               | 多个进程       | 内存映射 / 简单快速 / 操作系统不保证同步                               |
| 消息队列 | 比信号多，但有限制 | 任何           | 有格式 / 按消息类型过滤 / 操作系统负责同步                             |
| 套接字   | 大量               | 不同主机的进程 | 读缓存区 / 写缓冲区 / 操作系统负责同步                                 |

### 7. 线程

&emsp;线程是**进程中的一个实体，是被系统独立调度的基本单位**。

#### 7.1 线程的引入

- 引入进程的目的：多个程序更好地并发执行，改善资源利用率、提高系统效率；
- 引入线程的目的：减少并发执行时所付出的时空开销，使并发细粒度更细、并发性更好。

#### 7.2 进程的两个基本属性

- 进程是一个资源分配的基本单位；
- 进程是一个可独立调度和分派的基本单位；

#### 7.3 引入线程的好处

- 创建一个新线程花费时间少；
- 线程的终止时间比进程短；
- 同进程内的线程切换时间比进程短；
- 同一进程内的线程之间相互可以通信而无需调用内核；
